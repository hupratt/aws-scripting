<VirtualHost *:80>
    ServerName www.pythonbots.site
    Redirect permanent / https://www.pythonbots.site/
</VirtualHost>

<VirtualHost *:443>
    ServerName www.pythonbots.site
    SSLProxyEngine On
    SSLCertificateFile /etc/letsencrypt/live/www.pythonbots.site/cert.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/www.pythonbots.site/privkey.pem
    ProxyPreserveHost On

    # add a sticky path to persist user sessions
    Header add Set-Cookie "ROUTEID=.%{BALANCER_WORKER_ROUTE}e; path=/" env=BALANCER_ROUTE_CHANGED
    <Proxy balancer://mycluster/>
        BalancerMember https://3.9.97.82 route=1
        BalancerMember https://3.11.137.174 route=2
        ProxySet stickysession=ROUTEID
    </Proxy>

    # proxy all incoming requests to ServerName to the BalancerMembers
    ProxyPass / balancer://mycluster/
    ProxyPassReverse / balancer://mycluster/
</VirtualHost>
